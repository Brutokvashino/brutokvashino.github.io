<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Privateers Naval Combat</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #1e3f66;
    }
    #gameArea {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    .ship {
      position: absolute;
      width: 60px;
      height: 30px;
      background-color: #ccc;
      border: 2px solid #333;
      border-radius: 5px;
      transform-origin: center;
    }
    .player {
      background-color: #4caf50;
    }
    .enemy {
      background-color: #f44336;
    }
    .cannonball {
      position: absolute;
      width: 8px;
      height: 8px;
      background-color: black;
      border-radius: 50%;
    }
    .healthbar {
      position: absolute;
      height: 5px;
      background-color: red;
      top: -10px;
      left: 0;
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <div id="playerShip" class="ship player"></div>
  </div>

  <script>
    const gameArea = document.getElementById('gameArea');
    const playerShip = document.getElementById('playerShip');
    let keys = {};

    document.addEventListener('keydown', e => keys[e.key] = true);
    document.addEventListener('keyup', e => keys[e.key] = false);

    class Ship {
      constructor(element, isPlayer = false) {
        this.el = element;
        this.x = window.innerWidth / 2;
        this.y = window.innerHeight / 2;
        this.angle = 0;
        this.speed = 0;
        this.maxSpeed = 3;
        this.acceleration = 0.1;
        this.friction = 0.05;
        this.vx = 0;
        this.vy = 0;
        this.reload = false;
        this.health = 100;
        this.isPlayer = isPlayer;
        this.healthBar = document.createElement('div');
        this.healthBar.classList.add('healthbar');
        this.el.appendChild(this.healthBar);
      }

      updateControls() {
        if (keys['ArrowLeft']) this.angle -= 2;
        if (keys['ArrowRight']) this.angle += 2;
        if (keys['ArrowUp']) {
          this.speed += this.acceleration;
          if (this.speed > this.maxSpeed) this.speed = this.maxSpeed;
        } else {
          this.speed -= this.friction;
          if (this.speed < 0) this.speed = 0;
        }
        if (keys['ArrowDown']) {
          this.speed -= this.acceleration * 2;
          if (this.speed < 0) this.speed = 0;
        }
        if (keys['a'] && !this.reload) this.fireCannons(-90);
        if (keys['d'] && !this.reload) this.fireCannons(90);
      }

      updateAI(target) {
        const dx = target.x - this.x;
        const dy = target.y - this.y;
        const desiredAngle = Math.atan2(dy, dx) * 180 / Math.PI;
        let diff = desiredAngle - this.angle;
        if (diff > 180) diff -= 360;
        if (diff < -180) diff += 360;
        this.angle += diff > 0 ? 1 : -1;
        this.speed += this.acceleration;
        if (this.speed > this.maxSpeed) this.speed = this.maxSpeed;
        if (!this.reload) this.fireCannons(90); // fire right side
      }

      move() {
        const rad = this.angle * Math.PI / 180;
        this.vx = Math.cos(rad) * this.speed;
        this.vy = Math.sin(rad) * this.speed;
        this.x += this.vx;
        this.y += this.vy;
        this.x = Math.max(0, Math.min(window.innerWidth - 60, this.x));
        this.y = Math.max(0, Math.min(window.innerHeight - 30, this.y));
        this.el.style.left = this.x + 'px';
        this.el.style.top = this.y + 'px';
        this.el.style.transform = `rotate(${this.angle}deg)`;
        this.healthBar.style.width = this.health + '%';
      }

      fireCannons(offsetAngle) {
        this.reload = true;
        const baseAngle = this.angle + offsetAngle;
        for (let i = -1; i <= 1; i++) {
          const cannonball = document.createElement('div');
          cannonball.classList.add('cannonball');
          cannonball.style.left = (this.x + 30) + 'px';
          cannonball.style.top = (this.y + 15 + i * 10) + 'px';
          gameArea.appendChild(cannonball);

          const rad = baseAngle * Math.PI / 180;
          const dx = Math.cos(rad) * 5;
          const dy = Math.sin(rad) * 5;
          let distance = 0;
          let interval = setInterval(() => {
            let cx = parseInt(cannonball.style.left);
            let cy = parseInt(cannonball.style.top);
            cx += dx;
            cy += dy;
            distance += Math.sqrt(dx * dx + dy * dy);
            cannonball.style.left = cx + 'px';
            cannonball.style.top = cy + 'px';

            [...ships].forEach(ship => {
              if (ship !== this && Math.abs(cx - ship.x) < 30 && Math.abs(cy - ship.y) < 15) {
                ship.health -= 10;
                cannonball.remove();
                clearInterval(interval);
              }
            });

            if (cx < 0 || cx > window.innerWidth || cy < 0 || cy > window.innerHeight || distance > 300) {
              cannonball.remove();
              clearInterval(interval);
            }
          }, 30);
        }

        setTimeout(() => this.reload = false, 2000);
      }
    }

    const player = new Ship(playerShip, true);
    const ships = [player];

    function spawnEnemy() {
      const enemyEl = document.createElement('div');
      enemyEl.classList.add('ship', 'enemy');
      gameArea.appendChild(enemyEl);
      const enemy = new Ship(enemyEl);

      const edge = Math.floor(Math.random() * 4);
      switch (edge) {
        case 0: enemy.x = -60; enemy.y = Math.random() * window.innerHeight; break; // left
        case 1: enemy.x = window.innerWidth + 60; enemy.y = Math.random() * window.innerHeight; break; // right
        case 2: enemy.x = Math.random() * window.innerWidth; enemy.y = -30; break; // top
        case 3: enemy.x = Math.random() * window.innerWidth; enemy.y = window.innerHeight + 30; break; // bottom
      }

      ships.push(enemy);
    }

    setInterval(spawnEnemy, 12000); // spawn every 12 seconds

    function gameLoop() {
      ships.forEach(ship => {
        if (ship.health <= 0) {
          ship.el.remove();
          ships.splice(ships.indexOf(ship), 1);
        } else {
          if (ship.isPlayer) ship.updateControls();
          else ship.updateAI(player);
          ship.move();
        }
      });
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
